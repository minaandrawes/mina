--p1
GO
CREATE PROCEDURE ViewEmployeeInfo
    @EmployeeID INT
AS
BEGIN
    IF NOT EXISTS (SELECT 1 FROM Employee WHERE employee_id = @EmployeeID)
    BEGIN
        PRINT 'Employee not found';
        RETURN;
    END
    
    SELECT * 
    FROM Employee
    WHERE employee_id = @EmployeeID;
END;
GO

--p2
GO
CREATE PROCEDURE AddEmployee
    @FirstName VARCHAR(50),
    @LastName VARCHAR(50),
    @Email VARCHAR(100),
    @DepartmentID INT,
    @PositionID INT,
    @HireDate DATE
AS
BEGIN
    IF @FirstName IS NULL OR @LastName IS NULL OR @Email IS NULL OR @DepartmentID IS NULL OR @PositionID IS NULL OR @HireDate IS NULL
    BEGIN
        PRINT 'One of the inputs is null';
        RETURN;
    END
    
    IF EXISTS (SELECT 1 FROM Employee WHERE email = @Email)
    BEGIN
        PRINT 'Email already exists';
        RETURN;
    END
    
    IF NOT EXISTS (SELECT 1 FROM Department WHERE department_id = @DepartmentID)
    BEGIN
        PRINT 'Department not found';
        RETURN;
    END
    
    IF NOT EXISTS (SELECT 1 FROM Position WHERE position_id = @PositionID)
    BEGIN
        PRINT 'Position not found';
        RETURN;
    END
    
    INSERT INTO Employee (first_name, last_name, email, department_id, position_id, hire_date)
    VALUES (@FirstName, @LastName, @Email, @DepartmentID, @PositionID, @HireDate);
    
    PRINT 'Employee added successfully';
END;
GO

--p3
GO
CREATE PROCEDURE UpdateEmployeeInfo
    @EmployeeID INT,
    @Email VARCHAR(100),
    @Phone VARCHAR(20),
    @Address VARCHAR(150)
AS
BEGIN
    UPDATE Employee
    SET email = @Email,
        phone = @Phone,
        address = @Address
    WHERE employee_id = @EmployeeID;
    
    PRINT 'Employee information updated successfully';
END;
GO

--p4
GO
CREATE PROCEDURE AssignRole
    @EmployeeID INT,
    @RoleID INT
AS
BEGIN
    INSERT INTO Employee_Role (employee_id, role_id, assigned_date)
    VALUES (@EmployeeID, @RoleID, CURRENT_TIMESTAMP);
    
    PRINT 'Role assigned successfully';
END;
GO

--p5
GO
CREATE PROCEDURE GetDepartmentEmployeeStats
AS
BEGIN
    SELECT 
        d.department_name,
        COUNT(e.employee_id) AS number_of_employees
    FROM Department d
    LEFT JOIN Employee e ON d.department_id = e.department_id
    GROUP BY d.department_id, d.department_name;
END;
GO

--p6
GO
CREATE PROCEDURE ReassignManager
    @EmployeeID INT,
    @NewManagerID INT
AS
BEGIN
    UPDATE Employee
    SET manager_id = @NewManagerID
    WHERE employee_id = @EmployeeID;
    
    PRINT 'Manager reassigned successfully';
END;
GO

--p7
GO
CREATE PROCEDURE ReassignHierarchy
    @EmployeeID INT,
    @NewDepartmentID INT,
    @NewManagerID INT
AS
BEGIN
    UPDATE Employee
    SET department_id = @NewDepartmentID,
        manager_id = @NewManagerID
    WHERE employee_id = @EmployeeID;
    
    PRINT 'Hierarchy reassigned successfully';
END;
GO

--p8
GO
CREATE PROCEDURE NotifyStructureChange
    @AffectedEmployees VARCHAR(500),
    @Message VARCHAR(200)
AS
BEGIN
    INSERT INTO Notification (message_content, urgency, notification_type)
    VALUES (@AffectedEmployees + ': ' + @Message, 'High', 'System');
    
    PRINT 'Structure change notification sent';
END;
GO

--p9
GO
CREATE PROCEDURE ViewOrgHierarchy
    @AffectedEmployees VARCHAR(500),
    @Message VARCHAR(200)
AS
BEGIN
    SELECT 
        e.full_name AS employee_name,
        m.full_name AS manager_name,
        d.department_name,
        p.position_title,
        eh.hierarchy_level
    FROM Employee e
    LEFT JOIN Employee m ON e.manager_id = m.employee_id
    LEFT JOIN Department d ON e.department_id = d.department_id
    LEFT JOIN Position p ON e.position_id = p.position_id
    LEFT JOIN EmployeeHierarchy eh ON e.employee_id = eh.employee_id;
END;
GO

--p10
GO
CREATE PROCEDURE AssignShiftToEmployee
    @EmployeeID INT,
    @ShiftID INT,
    @StartDate DATE,
    @EndDate DATE
AS
BEGIN
    INSERT INTO ShiftAssignment (employee_id, shift_id, start_date, end_date, status)
    VALUES (@EmployeeID, @ShiftID, @StartDate, @EndDate, 'Active');
    
    PRINT 'Shift assigned to employee successfully';
END;
GO

--p11
GO
CREATE PROCEDURE UpdateShiftStatus
    @ShiftAssignmentID INT,
    @Status VARCHAR(20)
AS
BEGIN
    UPDATE ShiftAssignment
    SET status = @Status
    WHERE assignment_id = @ShiftAssignmentID;
    
    PRINT 'Shift status updated successfully';
END;
GO

--p12
GO
CREATE PROCEDURE AssignShiftToDepartment
    @DepartmentID INT,
    @ShiftID INT,
    @StartDate DATE,
    @EndDate DATE
AS
BEGIN
    INSERT INTO ShiftAssignment (employee_id, shift_id, start_date, end_date, status)
    SELECT employee_id, @ShiftID, @StartDate, @EndDate, 'Active'
    FROM Employee
    WHERE department_id = @DepartmentID;
    
    PRINT 'Shift assigned to department successfully';
END;
GO

--p13
GO
CREATE PROCEDURE AssignCustomShift
    @EmployeeID INT,
    @ShiftName VARCHAR(50),
    @ShiftType VARCHAR(50),
    @StartTime TIME,
    @EndTime TIME,
    @StartDate DATE,
    @EndDate DATE
AS
BEGIN
    DECLARE @ShiftID INT;
    
    INSERT INTO ShiftSchedule (name, type, start_time, end_time, shift_date, status)
    VALUES (@ShiftName, @ShiftType, @StartTime, @EndTime, @StartDate, 'Active');
    
    SET @ShiftID = (SELECT MAX(shift_id) FROM ShiftSchedule);
    
    INSERT INTO ShiftAssignment (employee_id, shift_id, start_date, end_date, status)
    VALUES (@EmployeeID, @ShiftID, @StartDate, @EndDate, 'Active');
    
    PRINT 'Custom shift assigned successfully';
END;
GO

--p14
GO
CREATE PROCEDURE ConfigureSplitShift
    @ShiftName VARCHAR(50),
    @FirstSlotStart TIME,
    @FirstSlotEnd TIME,
    @SecondSlotStart TIME,
    @SecondSlotEnd TIME
AS
BEGIN
    INSERT INTO ShiftSchedule (name, type, start_time, end_time, status)
    VALUES (@ShiftName + ' - AM', 'Split', @FirstSlotStart, @FirstSlotEnd, 'Active');
    
    INSERT INTO ShiftSchedule (name, type, start_time, end_time, status)
    VALUES (@ShiftName + ' - PM', 'Split', @SecondSlotStart, @SecondSlotEnd, 'Active');
    
    PRINT 'Split shift configured successfully';
END;

--p15
GO
CREATE PROCEDURE EnableFirstInLastOut
    @Enable BIT
AS
BEGIN
    IF @Enable = 1
        PRINT 'First In/Last Out attendance processing enabled';
    ELSE
        PRINT 'First In/Last Out attendance processing disabled';
END;
GO

--p16
GO
CREATE PROCEDURE TagAttendanceSource
    @AttendanceID INT,
    @SourceType VARCHAR(20),
    @DeviceID INT,
    @Latitude DECIMAL(10,7),
    @Longitude DECIMAL(10,7)
AS
BEGIN
    INSERT INTO AttendanceSource (attendance_id, device_id, source_type, latitude, longitude, recorded_at)
    VALUES (@AttendanceID, @DeviceID, @SourceType, @Latitude, @Longitude, CURRENT_TIMESTAMP);
    
    PRINT 'Attendance source tagged successfully';
END;
GO

--p17
GO
CREATE PROCEDURE SyncOfflineAttendance
    @DeviceID INT,
    @EmployeeID INT,
    @ClockTime DATETIME,
    @Type VARCHAR(10)
AS
BEGIN
    IF @Type = 'In'
        INSERT INTO Attendance (employee_id, entry_time, login_method)
        VALUES (@EmployeeID, @ClockTime, 'Offline Sync');
    ELSE
        UPDATE Attendance
        SET exit_time = @ClockTime,
            logout_method = 'Offline Sync'
        WHERE employee_id = @EmployeeID 
        AND exit_time IS NULL;
    
    PRINT 'Offline attendance synced successfully';
END;
GO

--p18
GO
CREATE PROCEDURE LogAttendanceEdit
    @HolidayID INT
AS
BEGIN
    INSERT INTO AttendanceLog (attendance_id, actor, timestamp, reason)
    SELECT attendance_id, NULL, CURRENT_TIMESTAMP, 'Holiday applied'
    FROM Attendance
    WHERE exception_id = @HolidayID;
    
    PRINT 'Attendance edit logged successfully';
END;
GO

--p19
GO
CREATE PROCEDURE ApplyHolidayOverrides
    @AttendanceID INT,
    @EditedBy INT,
    @OldValue DATETIME,
    @NewValue DATETIME,
    @EditTimestamp DATETIME
AS
BEGIN
    UPDATE Attendance
    SET entry_time = @NewValue
    WHERE attendance_id = @AttendanceID;
    
    INSERT INTO AttendanceLog (attendance_id, actor, timestamp, reason)
    VALUES (@AttendanceID, @EditedBy, @EditTimestamp, 'Holiday override applied');
    
    PRINT 'Holiday override applied successfully';
END;
GO

--p20
GO
CREATE PROCEDURE ManageUserAccounts
    @UserID INT,
    @Role VARCHAR(50),
    @Action VARCHAR(20)
AS
BEGIN
    DECLARE @RoleID INT;
    
    SELECT @RoleID = role_id 
    FROM Role 
    WHERE role_name = @Role;
    
    IF @Action = 'Add'
        INSERT INTO Employee_Role (employee_id, role_id, assigned_date)
        VALUES (@UserID, @RoleID, CURRENT_TIMESTAMP);
    
    ELSE IF @Action = 'Remove'
        DELETE FROM Employee_Role
        WHERE employee_id = @UserID AND role_id = @RoleID;
    
    ELSE IF @Action = 'Update'
        UPDATE Employee
        SET is_active = 1
        WHERE employee_id = @UserID;
    
    PRINT 'User account managed successfully';
END;
GO
