--p1
GO
CREATE PROCEDURE ReviewLeaveRequest
    @LeaveRequestID INT,
    @ManagerID INT,
    @Decision VARCHAR(20)
AS
BEGIN
    UPDATE LeaveRequest
    SET status = @Decision
    WHERE request_id = @LeaveRequestID;
    
    SELECT @LeaveRequestID AS LeaveRequestID, @ManagerID AS ManagerID, @Decision AS Decision;
    PRINT 'Leave request reviewed successfully';
END;
GO

--p2
GO
CREATE PROCEDURE AssignShift
    @EmployeeID INT,
    @ShiftID INT
AS
BEGIN
    INSERT INTO ShiftAssignment (employee_id, shift_id, status)
    VALUES (@EmployeeID, @ShiftID, 'Active');
    
    PRINT 'Shift assigned successfully';
END;
GO

--p3
GO
CREATE PROCEDURE ViewTeamAttendance
    @ManagerID INT,
    @DateRangeStart DATE,
    @DateRangeEnd DATE
AS
BEGIN
    SELECT 
        a.attendance_id,
        e.full_name AS employee_name,
        a.entry_time,
        a.exit_time,
        a.duration
    FROM Attendance a
    INNER JOIN Employee e ON a.employee_id = e.employee_id
    WHERE e.manager_id = @ManagerID
    AND a.entry_time >= @DateRangeStart
    AND a.entry_time <= @DateRangeEnd;
END;
GO

--p4
GO
CREATE PROCEDURE SendTeamNotification
    @ManagerID INT,
    @MessageContent VARCHAR(500),
    @UrgencyLevel VARCHAR(50)
AS
BEGIN
    DECLARE @NotificationID INT;
    
    INSERT INTO Notification (message_content, urgency)
    VALUES (@MessageContent, @UrgencyLevel);
    
    SET @NotificationID = (SELECT MAX(notification_id) FROM Notification);
    INSERT INTO Employee_Notification (employee_id, notification_id)
    SELECT employee_id, @NotificationID
    FROM Employee
    WHERE manager_id = @ManagerID;
    
    PRINT 'Team notification sent successfully';
END;
GO

--p5
GO
CREATE PROCEDURE ApproveMissionCompletion
    @MissionID INT,
    @ManagerID INT,
    @Remarks VARCHAR(200)
AS
BEGIN
    UPDATE Mission
    SET status = 'Completed'
    WHERE mission_id = @MissionID
    AND manager_id = @ManagerID;
    
    PRINT 'Mission completion approved';
END;
GO

--p6
GO
CREATE PROCEDURE RequestReplacement
@EmployeeID INT,
@Reason VARCHAR(150)
AS
BEGIN
    DECLARE @EmployeeName VARCHAR(200);
    SELECT @EmployeeName = full_name
    FROM Employee
    WHERE employee_id = @EmployeeID;
    
    INSERT INTO Notification (message_content, urgency, notification_type)
    VALUES ('Replacement needed for ' + @EmployeeName + ' (ID: ' + CAST(@EmployeeID AS VARCHAR) + '). Reason: ' + @Reason, 'High', 'Replacement');
    
    PRINT 'Replacement request submitted';
END;
GO

--p7
GO
CREATE PROCEDURE ViewDepartmentSummary
    @DepartmentID INT
AS
BEGIN
    SELECT d.department_name, COUNT(e.employee_id) AS employee_count, COUNT(m.mission_id) AS projects_count
    FROM Department d
    LEFT JOIN Employee e ON d.department_id = e.department_id
    LEFT JOIN Mission m ON e.employee_id = m.employee_id
    WHERE d.department_id = @DepartmentID
    GROUP BY d.department_id, d.department_name;
END;
GO

--p8
GO
CREATE PROCEDURE ReassignShift
    @EmployeeID INT, 
    @OldShiftID INT, 
    @NewShiftID INT 
  AS
  BEGIN
  INSERT INTO ShiftAssignment (employee_id, shift_id, status)
    VALUES (@EmployeeID, @NewShiftID, 'Active');
    
    PRINT 'Shift reassigned to employee successfully';
END;
GO

--p9
GO
CREATE PROCEDURE GetPendingLeaveRequests
   @ManagerID INT
  AS
  BEGIN
  SELECT lr.employee_id, lr.request_id
  FROM LeaveRequest lr
  INNER JOIN Employee e ON lr.employee_id = e.employee_id
  WHERE @ManagerID = e.manager_id AND lr.status LIKE 'Pending';
  
  END;
  GO
  
